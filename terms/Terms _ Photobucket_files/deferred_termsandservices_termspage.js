$.getObject("Pb.Component.Element",!0).Filmstrip=function(){function e(){this.init.apply(this,arguments)}var t={properties:{},init:function(e){$.extend(this.properties,e);this.initEvents()},initEvents:function(){$.views.tags("thumbnailAction",{template:this.properties.itemActionTemplate});$.views.tags("filmstripAction",{template:this.properties.filmstripActionTemplate});$.views.helpers({getCountFromKey:function(e){return Pb.Data.Shared.get(e)?Pb.Data.Shared.get(e).length:0}});$(document).one(this.properties.initEvent,$.proxy(function(e){this.initFilmstrip(e)},this));$(document).one(this.properties.hideEvent,$.proxy(function(e){this.hideFilmstrip(e)},this))},initFilmstrip:function(e){if(Pb.Data.get(this.properties.pbdKey)){this.filmstrip=$("#"+this.properties.id);this.filmstripWrapper=$("#"+this.properties.id+"Wrapper");this.itemWidth=this.filmstrip.find(".filmstrip-item:first").outerWidth(!0);this.totalItems=Pb.Data.get(this.properties.pbdKey).length;this.filmstripWidth=this.totalItems*this.itemWidth;if(this.properties.showPagination){this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);setTimeout($.proxy(function(){this.viewportWidth=this.filmstrip.outerWidth(!0);this.totalItems>Math.floor(this.viewportWidth/this.itemWidth)&&this.filmstrip.find(".filmstrip-next").show()},this),500)}this.filmstripWrapper.on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-next",$.proxy(this.next,this)).on("click."+this.properties.id+" touchstart."+this.properties.id,".filmstrip-prev",$.proxy(this.prev,this));$(document).on("click."+this.properties.id+" touchstart."+this.properties.id,"#"+this.properties.id+"Wrapper .action",$.proxy(this.triggerAction,this));Modernizr.touch&&this.initializeTouch();this.properties.context==="organizer"&&$(document).on("OrganizerThumbnails::selectedChanged."+this.properties.id,$.throttle(250,$.proxy(function(e){this.filmstripWrapper.find(".filmstrip-actions #selectedCount").html(e.selected)},this)))}},hideFilmstrip:function(e){$(document).off("."+this.properties.id);this.filmstripWrapper&&this.filmstripWrapper.off("."+this.properties.id);this.filmstrip&&this.filmstrip.find(".filmstrip-viewport").off("."+this.properties.id)},prev:function(){var e=this.getPrev();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},next:function(){var e=this.getNext();this.filmstrip.find(".filmstrip-wrapper").animate({left:e+"px"},"slow","linear",$.proxy(this.setArrows(e),this))},getPrev:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e+=this.properties.scrollingItems*this.itemWidth;e*-1<=0&&(e=0);return e},getNext:function(){var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);isNaN(e)&&(e=0);e-=this.properties.scrollingItems*this.itemWidth;(e-this.viewportWidth)*-1>=this.filmstripWidth&&(e=(this.filmstripWidth-this.viewportWidth)*-1);return e},setArrows:function(e){e<0?this.filmstrip.find(".filmstrip-prev").show():this.filmstrip.find(".filmstrip-prev").hide();(e-this.viewportWidth)*-1>=this.filmstripWidth?this.filmstrip.find(".filmstrip-next").hide():this.filmstrip.find(".filmstrip-next").show()},onRemove:function(){if(this.properties.showPagination){this.filmstripWidth=this.itemWidth*this.filmstrip.find(".filmstrip-item").length;this.filmstrip.find(".filmstrip-wrapper").width(this.filmstripWidth);this.viewportWidth=this.filmstrip.outerWidth(!0);var e=parseInt(this.filmstrip.find(".filmstrip-wrapper").css("left"),10);this.setArrows(e)}},triggerAction:function(e){var t=$(e.currentTarget).data("type");switch(t){case"remove":var n=$(e.currentTarget).closest(".filmstrip-item");n.fadeOut(500,$.proxy(function(){n.remove();this.onRemove()},this));break;default:}this.filmstripWrapper.trigger($.Event("Pb.Component.Element.Filmstrip::"+t),{filmstripItem:e.currentTarget});$(document).trigger($.Event("Pb.Component.Element.Filmstrip::"+t),{filmstripItem:e.currentTarget})},initializeTouch:function(){mm={};mm.swipeTreshold=100;mm.allowedTime=300;this.filmstrip.find(".filmstrip-viewport").on("touchstart."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.ox=t.pageX;mm.oy=t.pageY;mm.startTime=(new Date).getTime()},this)).on("touchend."+this.properties.id,$.proxy(function(e){if(e.originalEvent.touches==undefined)var t=e;else var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];mm.dx=t.pageX-mm.ox;mm.dy=t.pageY-mm.oy;mm.endTime=(new Date).getTime()-mm.startTime;mm.dx<-mm.swipeTreshold&&mm.endTime<mm.allowedTime?this.next():mm.dx>mm.swipeTreshold&&mm.endTime<mm.allowedTime&&this.prev()},this))}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Login",!0).Register=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{isValid:!1,fetchingSuggestions:!1,registering:!1,isValidBirthday:!0,init:function(e){this.submitBtn=$("#registerButton");this.form=$("#registerForm");this.password2=$(".modal").find("#password2");this.component=e.component;this.fields={username:$(".modal").find("#username"),password:$(".modal").find("#password"),email:$("input#email",this.form),gender:$("input#genderM, input#genderF",this.form),birthDate:$("#birthdate").find("select"),birthDay:$("#birthDay",this.form),birthMonth:$("#birthMonth",this.form),birthYear:$("#birthYear",this.form),country:$("#country",this.form)};$(".control-group").each(function(e,t){!$(t).parent(".controls").length});Pb.Utilities.cookie("pb_under_age")&&(window.location="/register");this.initEvents()},initEvents:function(){$(this.form).submit($.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));this.submitBtn.on("click",$.proxy(this.onSubmit,this));this.fields.email.on("blur",$.proxy(this.checkEmail,this));this.fields.birthMonth.change($.proxy(this.checkBirthValue,this));this.fields.birthDate.change($.proxy(this.checkBirthValue,this));this.fields.birthYear.change($.proxy(this.preCheckBirthdate,this));this.fields.birthYear.blur($.proxy(this.preCheckBirthdate,this));this.fields.username.blur($.proxy(this.suggest,this)).keyup($.proxy(function(e){var t=$(e.currentTarget).val();t.length>50&&$(e.currentTarget).val(t.substr(0,50))}));this.password2.on("blur",$.proxy(this.handlePasswordBlur,this)).on("click",$.proxy(function(){if(this.password2.val()===this.fields.password.attr("placeholder")||this.password2.val()===""){this.fields.password.show();this.password2.hide();this.fields.password.val(this.password2.val());this.fields.password.focus()}},this)).on("keyup",$.proxy(function(e){this.displayHideLink(e)},this));this.fields.password.on("blur",$.proxy(this.handlePasswordBlur,this)).on("keyup",$.proxy(function(e){this.displayShowLink(e)},this));$(".modal").find("#password").tooltip({trigger:"hover",placement:"right",html:!0});this.fields.password.on("keypress",$.proxy(function(e){var t=String.fromCharCode(e.which);if(t.toUpperCase()===t&&t.toLowerCase()!==t&&!e.shiftKey){this.fields.password.parents(".controls").find(".help-inline").html("Caps lock is on. Passwords are case sensitive.");this.fields.password.parents(".controls").find(".help-inline").css("display","block");this.fields.password.parents(".controls").find(".help-inline").css("margin-top","20px")}else this.fields.password.parents(".controls").find(".help-inline").text()==="Caps lock is on. Passwords are case sensitive."&&this.fields.password.parents(".controls").find(".help-inline").html("")},this));$(".modal").find("#password").after($(".modal").find("#password2"));$("#genderM, #genderF").on("blur change",$.proxy(function(e){$("#genderM").is(":checked")===!1&&$("#genderF").is(":checked")===!1?$("#gender").parents(".control-group").addClass("error"):$("#gender").parents(".control-group").removeClass("error")}));$(".help-inline, .help-mobile").on("click","a",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget).text();t=t.replace(/ /g,"");$(".modal").find("#username").val(t);$("#greenCheckName").css("display","inline");$("#redXName").css("display","none");$(".modal").find("#username").focus();$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}));$(".hideLink").click($.proxy(function(e){e.preventDefault();this.fields.password.val(this.password2.val());$(".modal").find("#password").show();$(".modal").find("#password2").hide();this.displayShowLink()},this));$(".showLink").click($.proxy(function(e){e.preventDefault();$(".modal").find("#password2").val($(".modal").find("#password").val());$(".modal").find("#password").hide();$(".modal").find("#password2").show();this.displayHideLink()},this));$("#postalCode").blur($.proxy(this.checkPostal,this));$(".showLink").on("click",$.proxy(this.trackClick,this));$(".hideLink").on("click",$.proxy(this.trackClick,this));$("#registerButton").on("click",$.proxy(this.trackClick,this));$('#registrationForm .arrow, #registrationForm input[type="radio"]').on("mousedown",$.proxy(this.trackClick,this));$('#registrationForm input:not([type="radio"]), #registrationForm select').on("focus",$.proxy(this.trackClick,this));this.attachCaptcha()},attachCaptcha:function(){var e=new Pb.Component.Element.Captcha.Checkbox;e.renderCaptcha(".captchaContainer");$(e.id).on("Pb.Component.Element.Captcha.Checkbox::challenge_solved",$.proxy(this.handleCaptchaCompleted,this))},handleCaptchaCompleted:function(){$("#registerButton").removeAttr("disabled");$("fieldset.captchaContainer").removeClass("error")},handlePasswordBlur:function(e){var t;this.fields.password.is(":visible")?t=this.fields.password.val():t=this.password2.val();this.password2.val(t);this.fields.password.val(t);($(e.target).is("#password")||$(e.target).is("#password2")&&$(e.target).is(":visible"))&&this.validatePassword()},validatePassword:function(){var e=$(".modal").find("#password").val();this.password2.val(e);this.validPassword(e)?this.handleSuccess($(".modal").find("#password")):this.handleError($(".modal").find("#password"),this.messages.password)},displayShowLink:function(){var e=this.fields.password.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","none");$(".showLink").css("display","inline")}else this.hidePasswordLinks()},displayHideLink:function(){var e=this.password2.val();if(e.length&&e!==this.fields.password.attr("placeholder")){$(".hideLink").css("display","inline");$(".showLink").css("display","none")}else this.hidePasswordLinks()},hidePasswordLinks:function(){$(".hideLink").css("display","none");$(".showLink").css("display","none")},trackClick:function(e){var t=$(e.currentTarget),n=t.prop("name"),r="reg_modal",i="default";$(".externalSiteRegistration").length!==0&&(i="external");if(n===undefined||n==="")t.hasClass("arrow")?n="slidercaptcha":n="signUpBtn";var s=r+"_"+i+"_"+n+"_focus";Pb.Track.trn(r,s)},checkPostal:function(e){var t="input:text[id=postalCode]",n=$("#country").val();n!=="US"&&n!=="CA"&&this.removeWarning(t);if(!this.validPostalCode($("#postalCode").val())){this.handleError($(t),"");this.isValid=!1}else this.removeWarning(t)},showCongratsMessage:function(){$(".congratsMessage").css("display","block")},preCheckBirthdate:function(e){$(".birthdate.control-group").removeClass("error");$(".birthdate.control-group").find(".help-inline").html("");this.checkBirthdate(e)},checkBirthValue:function(e){var t=$(e.target).val();t===""?this.checkBirthdate(e):$(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""&&$(this.fields.birthYear).val()!==""&&this.checkBirthdate(e)},checkBirthdate:function(e){var t=$("#currentDate").val().split("-");t[2]=parseInt(t[2],10)-13;t[1]=parseInt(t[1],10);t[0]=parseInt(t[0],10);var n=parseInt($(this.fields.birthYear).val(),10);if($(this.fields.birthDay).val()!==""&&$(this.fields.birthMonth).val()!==""){if(n<t[2]){this.isValidBirthday=!0;return}if(n===t[2]){var r=parseInt($(this.fields.birthMonth).val(),10);if(r<t[1]){this.isValidBirthday=!0;return}if(r===t[1]){var i=parseInt($(this.fields.birthDay).val(),10);if(i<=t[0]){this.isValidBirthday=!0;return}}}}this.isValidBirthday=!1},checkEmail:function(e){setTimeout($.proxy(function(){var e=this.fields.email.val();if(!this.validEmail(e)){this.handleError(this.fields.email,"");return}Pb.Ajax.ajax({url:"/action/user/checkEmail",data:{email:e},success:$.proxy(function(t){if(t.status){if($(this.fields.username).val().length===0){var n=e.split("@")[0];this.autoPopUsername(n.replace(/[^\w\s]/gi,""))}this.handleSuccess(this.fields.email)}else t.messages&&this.handleError(this.fields.email,"")},this)})},this),0)},checkCaptcha:function(){if($("#g-recaptcha-response").val()===""&&$("#g-recaptcha-response").val().length===0){$(".captchaContainer").addClass("error");this.isValid=!1}},suggest:function(e){var t,n;if(e===undefined){t=this.fields.username[0].value;n=$(".modal").find("#username")}else{t=$(e.target).val();n=$(e.target)}if(!this.fetchingSuggestions&&this.validUsername(t)){this.fetchingSuggestions=!0;Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:t},success:$.proxy(function(e){if(e.status)if(e.data.available){n.parents(".control-group").removeClass("error");n.parent().find(".help-inline").html("");n.parents(".stacked").find(".help-mobile").html("");this.handleSuccess(this.fields.username)}else{var t="Suggestions: ",r=e.messages[0].details.replace(new RegExp("<br>","g")," "),i=t+r;this.handleError(this.fields.username,i)}this.fetchingSuggestions=!1},this),messageHandler:function(){return!0}})}this.validUsername(t)?this.handleSuccess(this.fields.username):this.handleError(this.fields.username,this.messages.username)},autoPopUsername:function(e){Pb.Ajax.ajax({url:"/action/user/suggest",data:{username:e},success:$.proxy(function(t){if(t.status){if(!t.data.available){var n=$($(t.messages[0].details)[2]).text();n=n.replace(/ /g,"");$(this.fields.username).val(n)}else $(this.fields.username).val(e);$(".modal").find("#username").parents(".control-group").removeClass("warning").removeClass("error");$(".modal").find("#username").parents(".controls").find(".help-inline").html("");$(".modal").find("#username").parents(".control-group").find(".help-inline").html("")}},this),messageHandler:function(){return!0}})},removeWarning:function(e){$(e,this.form).parents(".control-group").removeClass("warning").removeClass("error");$(e,this.form).parents(".controls").find(".help-inline").html("");$(e,this.form).parents(".control-group").find(".help-inline").html("")},tip:function(e){$(e.target).tooltip("show")},validate:function(){this.submitBtn.text("Validating...").prop("disabled","disabled");this.isValid=!0;$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");this.validateRequired(this.fields,this.handleRequiredError,this);this.checkPostal();this.checkBirthdate();this.checkCaptcha();this.validEmail(this.fields.email.val())?this.handleSuccess(this.fields.email):this.handleError(this.fields.email,this.messages.email);this.suggest();this.validPassword(this.fields.password.val())?this.handleSuccess(this.fields.password):this.handleError(this.fields.password,this.messages.password)},handleError:function(e,t){e.parents(".control-group").removeClass("success").addClass("error");e.parents(".control-group").find(".help-inline").html(t);e.parents(".stacked").find(".help-mobile").html(t);e.css("background-color","rgb(255, 255, 255);");this.isValid=!1;return!0},handleSuccess:function(e){e.parents(".control-group").addClass("error").removeClass("error").addClass("success");e.parents(".stacked").find(".help-mobile").html("");e.parents(".control-group").find(".help-inline").html("")},handleRequiredError:function(e,t,n){e.parents(".control-group").addClass("error");e.prop("name")==="birthDay"||e.prop("name")==="birthMonth"||e.prop("name")==="birthYear"?$("div.birthdate > .controls > .help-inline").html(t.messages.required):e.parents(".controls").find(".help-inline").html(t.messages.required);n.isValid=!1},onSubmit:function(e){if(!this.registering&&!this.submitBtn.hasClass("disabled")&&this.submitBtn.prop("disabled")!=="disabled"){this.validate();if(this.isValid){if(!this.isValidBirthday){Pb.Utilities.cookie("pb_under_age",!0);window.location="/register";return}this.registering=!0;var t={},n=this.form.serializeArray(),r=0,i=n.length;for(r=0;r<i;r++)t[n[r].name]=n[r].value;Pb.Ajax.ajax({url:"/action/user/register",data:t,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){$("#"+e.memo).parents(".control-group").removeClass("success");if(e.memo==="birthDate"){$("#birthdate").parents(".control-group").addClass("error");$("#birthDateGroup").find("> .help-inline").html(e.message);this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!0}this.submitBtn.text("Create Account").removeAttr("disabled");this.registering=!1;return!1},this)})}else this.submitBtn.text("Create Account").removeAttr("disabled")}e.preventDefault()},onSuccess:function(e){var t=e.status,n={properties:{}};if(t&&e.data){Pb.Utilities.cookie("pb_firstlogin",!0);n.component=this.component;n.username=e.data.username;n.properties["registration type"]=e.data.source;n.properties.brand=e.data.brand;Pb.Data.get("mixpanel")&&(n.location=Pb.Data.get("mixpanel"));Pb.Component.Tracking.Mixpanel.trackCreateAccount(n);this.handleRegistration(e)}var r=$("#planLevel option:selected").text().split(" - ")[1];Pb.Track.tr("register_"+r+"_submit");this.registering=!1},handleRegistration:function(e){if(!$.isEmptyObject(e.data.redirect)){location.href=e.data.redirect;return}Pb.Component.Element.Message.showDefaultSuccessMessage();if(e.data.returnUrl==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else{var t=Pb.Data.get(Pb.Data.Shared.PRINT_PRODUCT),n=Pb.Data.get(Pb.Data.Shared.SELECTED_SET),r=Pb.Data.get(Pb.Data.Shared.ALBUM),i=Pb.Data.get(Pb.Data.Shared.MEDIA),s;if(t||n||r||i){s=$('<form action="'+e.data.returnUrl+'" method="POST"></form>');t&&$.each(t,function(e,t){s.append("<input type='hidden' name='"+e+"' value='"+t+"' />")});n&&$.each(n,function(e,t){s.append("<input type='hidden' name='selected[]' value='"+t+"' />")});r&&s.append("<input type='hidden' name='albumPath' value='"+encodeURIComponent(r.path)+"' />");i&&s.append("<input type='hidden' name='mediaUrl' value='"+encodeURIComponent(i.linkUrl)+"' />");s.appendTo("body").submit();return}window.location=e.data.returnUrl}}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init({component:"register modal"});e.screen!=="login"&&Pb.Component.Tracking.Mixpanel.trackPageView({"page name":"register modal"})},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init({component:"print register modal"});e.screen!=="login"&&Pb.Component.Tracking.Mixpanel.trackPageView({"page name":"print register modal"})},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();$.getObject("Pb.Component.Element.Captcha",!0).Checkbox=function(){function e(e){this.init(e)}var t={init:function(e){this.scriptTag="<script>var runCallback="+this.pbCaptchaCallback.toString()+";</script>";this.captchaSrc='<script src="https://www.google.com/recaptcha/api.js?onload=runCallback&render=explicit" async defer></script>';this.id="#checkboxCaptcha";this.instructions="Follow the instructions below to show you are human.";this.errorCopy="You must check the box to prove you're human.";this.redcopy="";Pb.Data.get("isAdBlockActive")&&(this.redcopy="This captcha might not work correctly if Ad Block is enabled. Please whitelist photobucket.com or disable Ad Block if you are experiencing issues.")},pbCaptchaCallback:function(){grecaptcha.render("recaptcha_widget",{sitekey:"6Ld39wYAAAAAAHRh1EnuW-QHMbOsPSRCNg4jgvqe",type:"image",callback:function(e){$("#checkboxCaptcha").trigger($.Event("Pb.Component.Element.Captcha.Checkbox::challenge_solved",{responseData:e}));$("#recaptcha_widget").removeClass("error")}})},renderCaptcha:function(e){var t=$(Pb.JSTemplates.render("#checkboxCaptchaTemplate",{errorCopy:this.errorCopy,instructions:this.instructions,scriptTag:this.scriptTag,captchaSrc:this.captchaSrc,redcopy:this.redcopy}));$("#checkboxCaptcha").remove();$(e).append(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Element.Form",!0).Honeypot=function(){function e(e){}return{init:e}}();$.getObject("Pb.Component.Common.Login",!0).Login=function(){function e(e){}$.extend(e.prototype,Pb.InputValidator.prototype,{loggingIn:!1,init:function(){this.loginBtn=$("#loginBtn");this.form=$("#loginForm");this.loggingIn=!1;$(this.form).submit($.proxy(this.onSubmit,this));this.loginBtn.on("click",$.proxy(this.onSubmit,this));$("input",this.form).keypress($.proxy(function(e){e.which===13&&this.onSubmit(e)},this));$("#loginForm").find(".loginHideLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword").val($("#loginForm").find("#loginPassword2").val());$("#loginForm").find("#loginPassword").show();$("#loginForm").find("#loginPassword2").hide();this.displayShowLink()},this));$("#loginForm").find(".loginShowLink").click($.proxy(function(e){e.preventDefault();$("#loginForm").find("#loginPassword2").val($("#loginForm").find("#loginPassword").val());$("#loginForm").find("#loginPassword").hide();$("#loginForm").find("#loginPassword2").show();this.displayHideLink()},this))},displayShowLink:function(){$("#loginForm").find(".loginHideLink").css("display","none");$("#loginForm").find(".loginShowLink").css("display","inline")},displayHideLink:function(){$("#loginForm").find(".loginHideLink").css("display","inline");$("#loginForm").find(".loginShowLink").css("display","none")},handleLogin:function(e){if(e.data.redirect==="print"){$("#saveProgressLoginModal")&&$("#saveProgressLoginModal").find(".close").click();window.location="/print?action=openPrint"}else{var t=Pb.Data.get(Pb.Data.Shared.PRINT_PRODUCT),n=Pb.Data.get(Pb.Data.Shared.SELECTED_SET),r=Pb.Data.get(Pb.Data.Shared.ALBUM),i=Pb.Data.get(Pb.Data.Shared.MEDIA),s;if(t||n||r||i){s=$('<form action="'+e.data.redirect+'" method="POST"></form>');t&&$.each(t,function(e,t){s.append("<input type='hidden' name='"+e+"' value='"+t+"' />")});n&&$.each(n,function(e,t){s.append("<input type='hidden' name='selected[]' value='"+t.linkUrl+"' />")});r&&s.append("<input type='hidden' name='albumPath' value='"+encodeURIComponent(r.path)+"' />");i&&s.append("<input type='hidden' name='mediaUrl' value='"+encodeURIComponent(i.linkUrl)+"' />");s.appendTo("body").submit();return}window.location=e.data.redirect}},onSuccess:function(e){var t=e.status;t&&e.data&&this.handleLogin(e);Pb.Track.tr("login_submit");this.loggingIn=!1;this.loginBtn.text("Log in")},onSubmit:function(){if(!this.loggingIn){this.loggingIn=!0;this.loginBtn.text("Logging in...");var e={},t=this.form.serializeArray(),n=0,r=t.length;for(n=0;n<r;n++)e[t[n].name]=t[n].value;Pb.Ajax.ajax({url:"/action/auth/login",data:e,success:$.proxy(this.onSuccess,this),messageHandler:$.proxy(function(e){this.loggingIn=!1;this.loginBtn.text("Log in");return!1},this)})}}});var t=new e;Pb.InitEventQueue.addToDomReady(function(){$(document).on("LoginModal::show",$.proxy(function(e,n){t.init()},this)).on("SaveProgressLoginModal::show",$.proxy(function(e,n){t.init()},this))},Pb.InitEventQueue.LOW_PRIORITY);return t}();window.fbAsyncInit=function(){FB.init({appId:Pb.Data.get("facebookKey"),version:"v2.3",status:!0,cookie:!0,xfbml:!0,oauth:!0,channelUrl:document.location.protocol+"//"+document.domain+"/channel.html"});$(document).trigger("Pb.Component.Facebook.Facebook::fb-init")};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/sdk.js";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk");$.getObject("Pb.Component.Facebook",!0).Facebook=function(){function e(e){var t={};e&&(t.scope=e);FB.login(function(e){if(e.authResponse){var t=e.authResponse;$(document).trigger({type:"Pb.Component.Facebook.Facebook::login",userId:t.userID,accessToken:t.accessToken,signedRequest:t.signedRequest})}else $(document).trigger("Pb.Component.Facebook.Facebook::login-failed")},t)}function t(){FB.logout(function(e){$(document).trigger("Pb.Component.Facebook.Facebook::logout")})}function n(){FB.getLoginStatus(function(e){$(document).trigger({type:"Pb.Component.Facebook.Facebook::login-status",status:e.status,authResponse:e.authResponse})})}function r(e,t){FB.api(e,t)}function i(e,t,n){$.isArray(e)||(e=e.split(","));FB.getLoginStatus(function(r){r.status==="connected"?FB.api("/me/permissions",function(r){var i=r.data,s,o=[],u=[],a;a=i.filter(function(e){return e.status==="granted"});for(s=0;s<a.length;s++)o.push(a[s].permission);for(s=0;s<e.length;s++)o.indexOf(e[s])===-1&&u.push(e[s]);if(u.length){n({status:"error",failedPerms:u});return}t({status:"success",grantedPerms:a})}):r.status==="not_authorized"?n({status:"not_authorized",failedPerms:e}):n({status:"error",failedPerms:e})})}return{login:e,logout:t,getLoginStatus:n,api:r,checkPerms:i}}();$.getObject("Pb.Component.Ad",!0).VideoAdModal=function(){function i(e,t){if($("#"+r).length){$("#"+r).empty();$(document).one("Pb.Component.Ad.VideoAd::adLoaded",function(){n.startAd()});n.initAd(e,t,Pb.Data.get("videoAdProps"));Pb.Track.tr("uploader_video_impression")}}function s(n){switch(n.type){case t.AdLoaded:$(document).trigger("Pb.Component.Ad.VideoAd::adLoaded");break;case t.AdStarted:e=!0;$(document).trigger("Pb.Component.Ad.VideoAd::adStarted");break;case t.AdCompanionDisplay:break;case t.AdClickThru:break;case t.AdStopped:e&&$(document).trigger("Pb.Component.Ad.VideoAd::adStopped");break;case t.AdError:}}function o(e){var i=__adaptv__,o=$(".ad.mrec").first(),a;r=e;n=new i.ads.vpaid.VPAIDAd(e);t=i.ads.vpaid.VPAIDEvent;for(a in t)t.hasOwnProperty(a)&&n.on(t[a],s);o.attr("id")===undefined&&o.attr("id","admrec_"+Math.random());u({companionId:o.attr("id")})}function u(e){var t=Pb.Data.get("videoAdProps"),n=$.extend(!0,t,e);Pb.Data.add("videoAdProps",n)}function a(e){Pb.Data.get("showAds")&&$.getScript("http://redir.adap.tv/redir/javascript/vpaid.js",function(){$.getScript("http://redir.adap.tv/redir/javascript/adaptvAdPlayer.js",function(){o(e)})})}var e=!1,t,n,r;Pb.InitEventQueue.add(function(){a("videoAdModal")},Pb.InitEventQueue.LOW_PRIORITY);return{init:a,playAd:i,setAdProps:u}}();